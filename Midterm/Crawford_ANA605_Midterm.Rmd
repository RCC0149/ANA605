---
title: "Week 2 Midterm Exam"
author: "Randall Crawford"
date: "`r Sys.Date()`"
output:
  word_document: default
---

### Getting Started
```{r Getting Started, include=FALSE}
library(knitr)
library(dplyr) 
library(ggplot2)
library(ggformula)
library(supernova)
library(lsr)
library(mosaic)
library(tidyverse)
library(data.table)
library(readxl)
```
### knitr Chunk Functionality
```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### Load Data
Great! Now load the data
```{r Load Data}
data <- read_excel(path = "C:\\Program Files\\R\\ANA 605\\R Data\\Midterm Exam\\data.xlsx", col_names = TRUE)
data
```

### Step 1: Conduct exploratory data analysis.  Provide a paragraph summary of your findings.	

#### A. Descriptive Statistics and Histogram For X1
```{r STEP 1A, echo=FALSE}
favstats(data$X1)
```
```{r, echo=FALSE}
gf_histogram(~ X1, data = data, fill = "green", color = "black", linewidth = 0.5, bins = 8, title = "Death Rate Histogram with Boxplot Overlay", ylim = c(0,20), xlim = c(0,15)) %>%
  gf_boxplot(fill = "purple", width = 1, color = "black", linewidth = 1.5) %>%
  gf_vline(xintercept = mean(data$X1), color = "red", linewidth = 1.5) + scale_y_continuous("Small City Count", breaks = breaks_pretty(n=10)) + scale_x_continuous("Death Rate per 1000 Residents", breaks = breaks_pretty(n=15))
```

#### B. Descriptive Statistics & Histogram For X2, including a Scatterplot with X1 
```{r STEP 1B, echo=FALSE}
favstats(data$X2)
```
```{r, echo=FALSE}
gf_histogram(~ X2, data = data, fill = "green", color = "black", linewidth = 0.5, bins = 18, title = "Doctor Availability Histogram with Boxplot Overlay", ylim = c(0,20), xlim = c(0,250)) %>%
  gf_boxplot(fill = "purple", width = 0.6, color = "black", linewidth = 1.5) %>%
  gf_vline(xintercept = mean(data$X2), color = "red", linewidth = 1.5) + scale_y_continuous("Small City Count", breaks = breaks_pretty(n=10)) + scale_x_continuous("Doctor Availability per 100,000 Residents", breaks = breaks_pretty(n=10))
```
```{r, echo=FALSE}
ggplot(
  data,
  aes(
    x = X2,
    y = X1
  )
) +
  geom_point(
    color = "blue",
    size = 2,
    shape = 16
  ) +
  scale_x_continuous(
    breaks = breaks_pretty(n=9)  
  ) +
  scale_y_continuous(
    breaks = breaks_pretty(n=15)
  ) +
  coord_cartesian(
    xlim = c(60,240),
    ylim = c(0,15)
  ) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    color = "red"
  ) +
  labs(
    title = "Death Rates To Doctor Availability Scatterplot",
    x = "Doctor Availability per 100,000 Residents",
    y = "Death Rate per 1000 Residents"
  )

```

#### C. Descriptive Statistics & Histogram For X3, including a Scatterplot with X1 
```{r STEP 1C, echo=FALSE}
favstats(data$X3)
```
```{r, echo=FALSE}
gf_histogram(~ X3, data = data, fill = "green", color = "black", linewidth = 0.5, bins = 16, title = "Hospital Bed Histogram with Boxplot Overlay", ylim = c(0,20), xlim = c(0,1850)) %>%
  gf_boxplot(fill = "purple", width = 1, color = "black", linewidth = 1.5) %>%
  gf_vline(xintercept = mean(data$X3), color = "red", linewidth = 1.5) + scale_y_continuous("Small City Count", breaks = breaks_pretty(n=10)) + scale_x_continuous("Hospital Bed Availability per 100,000 Residents", breaks = breaks_pretty(n=10))
```
```{r, echo=FALSE}
ggplot(
  data,
  aes(
    x = X3,
    y = X1
  )
) +
  geom_point(
    color = "blue",
    size = 2,
    shape = 16
  ) +
  scale_x_continuous(
    breaks = breaks_pretty(n=8)  
  ) +
  scale_y_continuous(
    breaks = breaks_pretty(n=15)
  ) +
  coord_cartesian(
    xlim = c(200,1800),
    ylim = c(0,15)
  ) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    color = "red"
  ) +
  labs(
    title = "Death Rates To Hospital Bed Scatterplot",
    x = "Hospital Bed Availability per 100,000 Residents",
    y = "Death Rate per 1000 Residents"
  )

```

#### D. Descriptive Statistics & Histogram For X4, including a Scatterplot with X1 
```{r STEP 1D, echo=FALSE}
favstats(data$X4)
```
```{r, echo=FALSE}
gf_histogram(~ X4, data = data, fill = "green", color = "black", linewidth = 0.5, bins = 7, title = "Per Capita Income Histogram with Boxplot Overlay", ylim = c(0,20), xlim = c(0,15)) %>%
  gf_boxplot(fill = "purple", width = 1, color = "black", linewidth = 1.5) %>%
  gf_vline(xintercept = mean(data$X4), color = "red", linewidth = 1.5) + scale_y_continuous("Small City Count", breaks = breaks_pretty(n=10)) + scale_x_continuous("Annual Per Capita Income in Thousands of Dollars", breaks = breaks_pretty(n=10))
```
```{r, echo=FALSE}
ggplot(
  data,
  aes(
    x = X4,
    y = X1
  )
) +
  geom_point(
    color = "blue",
    size = 2,
    shape = 16
  ) +
  scale_x_continuous(
    breaks = breaks_pretty(n=6)  
  ) +
  scale_y_continuous(
    breaks = breaks_pretty(n=15)
  ) +
  coord_cartesian(
    xlim = c(7,13),
    ylim = c(0,15)
  ) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    color = "red"
  ) +
  labs(
    title = "Death Rates To Per Capita Income Scatterplot",
    x = "Annual Per Capita Income in Thousands of Dollars",
    y = "Death Rate per 1000 Residents"
  )

```

#### E. Descriptive Statistics & Histogram For X5, including a Scatterplot with X1
```{r STEP 1E, echo=FALSE}
favstats(data$X5)
```
```{r, echo=FALSE}
gf_histogram(~ X5, data = data, fill = "green", color = "black", linewidth = 0.5, bins = 14, title = "Population Density Histogram with Boxplot Overlay", ylim = c(0,20), xlim = c(0,300)) %>%
  gf_boxplot(fill = "purple", width = 1, color = "black", linewidth = 1.5) %>%
  gf_vline(xintercept = mean(data$X5), color = "red", linewidth = 1.5) + scale_y_continuous("Small City Count", breaks = breaks_pretty(n=10)) + scale_x_continuous("Population Density People Per Square Mile", breaks = breaks_pretty(n=13))
```
```{r, echo=FALSE}
ggplot(
  data,
  aes(
    x = X5,
    y = X1
  )
) +
  geom_point(
    color = "blue",
    size = 2,
    shape = 16
  ) +
  scale_x_continuous(
    breaks = breaks_pretty(n=13)  
  ) +
  scale_y_continuous(
    breaks = breaks_pretty(n=15)
  ) +
  coord_cartesian(
    xlim = c(30,290),
    ylim = c(0,15)
  ) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    color = "red"
  ) +
  labs(
    title = "Death Rates To Population Density Scatterplot",
    x = "Population Density-People per Square Mile",
    y = "Death Rate per 1000 Residents"
  )

```

### Step 2: Perform multiple linear regression analysis to test the association between X1 (dependent variable) and the remaining variables.  Interpret you model.

#### A. Initial Multiple Linear Regression Analysis
```{r, STEP 2A, echo=FALSE}
MLR_model <- lm(X1 ~ X2 + X3 + X4 + X5, data = data)
MLR_model
```

#### B. Initial Supernova Analysis of MLR
```{r, STEP 2B, echo=FALSE}
supernova(MLR_model)
```

#### C.	Establish GLM Equation for MLR Model
$$
Y_i = b_0 + b_1(X2_i) + b_2(X3_i) + b_3(X4_i) + b_4(X5_i) + e_i
$$

$$
X1_i = 12.2662552 + 0.0073916(X2_i) + 0.0005837(X3_i) - 0.3302302(X4_i) - 0.0094629(X5_i) + e_i
$$

### Step 3: Investigate collinearity and adjust model accordingly.  Interpret your new model.

#### A. Correlation Matrix of Dataframe
```{r, STEP 3A, echo=FALSE}
cor(data)
```

#### B. Adjusted Simple Model
```{r, STEP 3B, echo=FALSE}
ADJ_model <- lm(X1 ~ X5, data = data)
ADJ_model
```

#### C. Supernova Analysis of Adjusted Simple Model
```{r, STEP 3C, echo=FALSE}
supernova(ADJ_model)
```

#### D.	Establish GLM Equation for Adjusted Simple Model
$$
Y_i = b_0 + b_1(X_i) + e_i
$$

$$
X1_i = 10.387997 - 0.009782(X5_i) + e_i
$$

### Step 4: Conduct residual analysis for the new model.

#### A. Add Adjusted Simple Model Residuals To The Dataset & Calculate Descriptive Statistics For Residuals
```{r, STEP 4A, echo=FALSE}
data$ADJ_resid <- resid(ADJ_model)
favstats(data$ADJ_resid)
```

#### B. Develop Histogram of Adjusted Simple Model Residuals
```{r, STEP 4B, echo=FALSE}
gf_histogram(~ ADJ_resid, data = data, fill = "green", color = "black", linewidth = 0.5, bins = 9, title = "Adjusted Simple Model Residual Histogram") %>%
  gf_vline(xintercept = median(data$ADJ_resid), color = "blue", linewidth = 1.5) + scale_y_continuous("Residual Count", breaks = breaks_pretty(n=10)) + scale_x_continuous("Residual Values", breaks = breaks_pretty(n=10))
```

#### C. Add Original MLR Model Residuals To The Dataset & Calculate Descriptive Statistics For Residuals
```{r, STEP 4C, echo=FALSE}
data$MLR_resid <- resid(MLR_model)
favstats(data$MLR_resid)
```

#### D. Develop Histogram of Original MLR Model Residuals
```{r, STEP 4D, echo=FALSE}
gf_histogram(~ MLR_resid, data = data, fill = "green", color = "black", linewidth = 0.5, bins = 9, title = "Original MLR Model Residual Histogram") %>%
  gf_vline(xintercept = median(data$MLR_resid), color = "blue", linewidth = 1.5) + scale_y_continuous("Residual Count", breaks = breaks_pretty(n=10)) + scale_x_continuous("Residual Values", breaks = breaks_pretty(n=10))
```

### Step 5: Conduct prediction analysis for the new model.

#### A. Add Adjusted Simple Model Predictions To The Dataset & Calculate Descriptive Statistics For Predictions
```{r, STEP 5A, echo=FALSE}
data$ADJ_predict <- predict(ADJ_model)
favstats(data$ADJ_predict)
```

#### B. Develop Histogram of Adjusted Simple Model Predictions
```{r, STEP 5B, echo=FALSE}
gf_histogram(~ ADJ_predict, data = data, fill = "green", color = "black", linewidth = 0.5, bins = 8, title = "Adjusted Simple Model Prediction Histogram", ylim = c(0,20), xlim = c(0,15)) %>%
  gf_boxplot(fill = "purple", width = 1.5, color = "black", linewidth = 1.5) %>%
  gf_vline(xintercept = mean(data$ADJ_predict), color = "red", linewidth = 1.5) + scale_y_continuous("Small City Count", breaks = breaks_pretty(n=10)) + scale_x_continuous("Death Rate per 1000 Residents", breaks = breaks_pretty(n=10))
```

#### C. Develop Scatterplot of Actual Death Rates to Adjusted Simple Model Predictions
```{r, STEP 5C, echo=FALSE}
ggplot(
  data,
  aes(
    x = ADJ_predict,
    y = X1
  )
) +
  geom_point(
    color = "blue",
    size = 2,
    shape = 16
  ) +
  scale_x_continuous(
    breaks = breaks_pretty(n=6)  
  ) +
  scale_y_continuous(
    breaks = breaks_pretty(n=15)
  ) +
  coord_cartesian(
    xlim = c(7.5,10),
    ylim = c(0,15)
  ) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    color = "red"
  ) +
  labs(
    title = "Death Rates To Simple Model Predictions Scatterplot",
    x = "Predicted Death Rate per 1000 Residents",
    y = "Death Rate per 1000 Residents"
  )

```

#### D. Determine Correlation Between Actual Death Rates to Adjusted MLR Model Predictions
```{r, STEP 5D, echo=FALSE}
ADJ_cor <- cor(X1 ~ ADJ_predict, data = data)
cat("The Pearson's r correlation coefficient equals", ADJ_cor, '\n')
```

#### E. Add Original MLR Model Predictions To The Dataset & Calculate Descriptive Statistics For Predictions
```{r, STEP 5E, echo=FALSE}
data$MLR_predict <- predict(MLR_model)
favstats(data$MLR_predict)
```

#### F. Develop Histogram of Original MLR Model Predictions
```{r, STEP 5F, echo=FALSE}
gf_histogram(~ MLR_predict, data = data, fill = "green", color = "black", linewidth = 0.5, bins = 8, title = "Original MLR Model Prediction Histogram", ylim = c(0,20), xlim = c(0,15)) %>%
  gf_boxplot(fill = "purple", width = 1, color = "black", linewidth = 1.5) %>%
  gf_vline(xintercept = mean(data$MLR_predict), color = "red", linewidth = 1.5) + scale_y_continuous("Small City Count", breaks = breaks_pretty(n=10)) + scale_x_continuous("Death Rate per 1000 Residents", breaks = breaks_pretty(n=10))
```

#### G. Develop Scatterplot of Actual Death Rates to Original MLR Model Predictions
```{r, STEP 5G, echo=FALSE}
ggplot(
  data,
  aes(
    x = MLR_predict,
    y = X1
  )
) +
  geom_point(
    color = "blue",
    size = 2,
    shape = 16
  ) +
  scale_x_continuous(
    breaks = breaks_pretty(n=6)  
  ) +
  scale_y_continuous(
    breaks = breaks_pretty(n=15)
  ) +
  coord_cartesian(
    xlim = c(7.5,10.5),
    ylim = c(0,15)
  ) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    color = "red"
  ) +
  labs(
    title = "Death Rates To MLR Model Predictions Scatterplot",
    x = "Predicted Death Rate per 1000 Residents",
    y = "Death Rate per 1000 Residents"
  )

```

#### H. Determine Correlation Between Actual Death Rates to Original MLR Model Predictions
```{r, STEP 5H, echo=FALSE}
MLR_cor <- cor(X1 ~ MLR_predict, data = data)
cat("The Pearson's r correlation coefficient equals", MLR_cor, '\n')
```

#### I. Develop Scatterplot of Adjusted Simple to Original MLR Model Predictions
```{r, STEP 5I, echo=FALSE}
ggplot(
  data,
  aes(
    x = MLR_predict,
    y = ADJ_predict
  )
) +
  geom_point(
    color = "blue",
    size = 2,
    shape = 16
  ) +
  scale_x_continuous(
    breaks = breaks_pretty(n=8)  
  ) +
  scale_y_continuous(
    breaks = breaks_pretty(n=8)
  ) +
  coord_cartesian(
    xlim = c(7.5,10.5),
    ylim = c(7.5,10.5)
  ) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    color = "red"
  ) +
  labs(
    title = "Simple To MLR Model Predictions Scatterplot",
    x = "MLR Predicted Death Rate per 1000 Residents",
    y = "Simple Predicted Death Rate per 1000 Residents"
  )

```

#### J. Determine Correlation Between Adjusted Simple to Original MLR Model Predictions
```{r, STEP 5J, echo=FALSE}
Both_cor <- cor(ADJ_predict ~ MLR_predict, data = data)
cat("The Pearson's r correlation coefficient equals", Both_cor, '\n')
```

### End.

