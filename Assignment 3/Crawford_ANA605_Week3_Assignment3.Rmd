---
title: "Assignment 3"
author: "Randall Crawford"
date: "11/17/2024"
output: word_document
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

## Read in data
myDataLocation <- "C:\\Program Files\\R\\ANA 605\\R Data\\Assignment 3"
setwd(myDataLocation)
dat <- read.csv(file = "cancer_data.csv", header = TRUE)

# Load and install required packages
library(knitr)
library(mosaic)
library(effsize)
library(supernova)
library(lsr)
library(dplyr)
library(ggplot2)
library(ggformula)
library(data.table)
```

## Question 1

1.  Descriptive statistics.

```{r}
str(dat)
```

a.  Quantitative Variables: perimeter_mean and texture_mean i. Create a histogram for each variable ii. Obtain the five number summaries for each variable

b.  Categorical Variable: diagnosis

c.  Create a boxplot with perimeter_mean as the explanatory variable ii. Obtain frequencies of the two categories. iii. Obtain means and standard deviations of perimeter_mean, aggregated by diagnosis

```{r}
#1a i. Histogram for Perimeter Mean.
gf_histogram(~ perimeter_mean, data = dat, fill = "green", color = "black", linewidth = 0.5, bins = 24, title = "Perimeter Mean Histogram with Boxplot Overlay") %>%
  gf_boxplot(fill = "purple", width = 5, color = "black", linewidth = 1.5) %>%
  gf_vline(xintercept = mean(dat$perimeter_mean) + sd(dat$perimeter_mean), color = "red", linetype = "dashed", linewidth = 1) %>%
  gf_vline(xintercept = mean(dat$perimeter_mean) - sd(dat$perimeter_mean), color = "red", linetype = "dashed", linewidth = 1) %>%
  gf_vline(xintercept = mean(dat$perimeter_mean) + (2 * sd(dat$perimeter_mean)), color = "red", linetype = "dashed", linewidth = 0.75) %>%
  gf_vline(xintercept = mean(dat$perimeter_mean) - (2 * sd(dat$perimeter_mean)), color = "red", linetype = "dashed", linewidth = 0.75) %>%
  gf_vline(xintercept = mean(dat$perimeter_mean) + (3 * sd(dat$perimeter_mean)), color = "red", linetype = "dashed", linewidth = 0.5) %>%
  gf_vline(xintercept = mean(dat$perimeter_mean) - (3 * sd(dat$perimeter_mean)), color = "red", linetype = "dashed", linewidth = 0.5) %>%
  gf_vline(xintercept = mean(dat$perimeter_mean), color = "red", linewidth = 1.5) + scale_y_continuous("Count", breaks = seq(0,90,10)) +   scale_x_continuous("Perimeter Mean Values", breaks = seq(40,190,10)) 
```
```{r}
#1a ii. Five Number Summary for Perimeter Mean.
favstats(dat$perimeter_mean)
```
```{r}
#1a i. Histogram for Texture Mean.
gf_histogram(~ texture_mean, data = dat, fill = "green", color = "black", linewidth = 0.5, bins = 24, title = "Texture Mean Histogram with Boxplot Overlay") %>%
  gf_boxplot(fill = "purple", width = 5, color = "black", linewidth = 1.5) %>%
  gf_vline(xintercept = mean(dat$texture_mean) + sd(dat$texture_mean), color = "red", linetype = "dashed", linewidth = 1) %>%
  gf_vline(xintercept = mean(dat$texture_mean) - sd(dat$texture_mean), color = "red", linetype = "dashed", linewidth = 1) %>%
  gf_vline(xintercept = mean(dat$texture_mean) + (2 * sd(dat$texture_mean)), color = "red", linetype = "dashed", linewidth = 0.75) %>%
  gf_vline(xintercept = mean(dat$texture_mean) - (2 * sd(dat$texture_mean)), color = "red", linetype = "dashed", linewidth = 0.75) %>%
  gf_vline(xintercept = mean(dat$texture_mean) + (3 * sd(dat$texture_mean)), color = "red", linetype = "dashed", linewidth = 0.5) %>%
  gf_vline(xintercept = mean(dat$texture_mean) - (3 * sd(dat$texture_mean)), color = "red", linetype = "dashed", linewidth = 0.5) %>%
  gf_vline(xintercept = mean(dat$texture_mean), color = "red", linewidth = 1.5) + scale_y_continuous("Count", breaks = seq(0,80,10)) +   scale_x_continuous("Texture Mean Values", breaks = seq(9,41,2))
```
```{r}
#1a ii. Five Number Summary for Texture Mean.
favstats(dat$texture_mean)
```
```{r}
#1b. Categorical Variable: diagnosis
gf_bar(~diagnosis, data = dat, fill = "brown", color = "black", linewidth = 0.5, title = "Diagnosis Barchart (Benign and Malignant)", xlab = "Diagnosis") + scale_y_continuous("Count", breaks = seq(0,400,50))
```
```{r}
#1c i. Boxplot for Perimeter Mean by Diagnosis Categories
gf_boxplot(perimeter_mean ~ diagnosis, data = dat, fill = "lightblue", border = "darkblue", outpch = 21, outbg = "darkblue", linewidth = 1, title = "Perimeter Mean by Diagnosis Categories Boxplots", xlab = "Diagnosis Categories")  + scale_y_continuous("Perimeter Mean Values", breaks = seq(40,200,20))
```
```{r}
#1c ii. Frequencies of Diagnosis Categories
ftable(dat$diagnosis)
```
```{r}
#1c iii. Means and Standard Deviations of Perimeter Mean Aggregated by Diagnosis Categories
agg <- with(dat, aggregate(perimeter_mean ~ diagnosis, FUN = function(x) c(Mean = mean(x), SD = sd(x))))
agg_view <- data.table(agg)
agg_view
```

## Question 2

2.  Correlation between perimeter_mean and texture_mean

a.  Obtain the correlation.

b.  Interpret the correlation (reference Assignment One for examples).

c.  What is the 95% confidence interval? Use cor.test().

d.  What is the 75% confidence interval? Use cor.test().

e.  Are you confident that the true population correlation could be zero? Why or why not?

```{r}
#2a. Correlation between Perimeter Mean and Texture Mean
PerTex_cor <- cor(perimeter_mean ~ texture_mean, data = dat)
cat("The Pearson's r correlation coefficient between Perimeter Mean and Texture Mean equals", PerTex_cor, '\n')
```

#2b. Correlation Interpretation for a.

The bivariate relationship between Perimeter Mean and Texture Mean has a weaker positive correlation, and a straight 
regression line may not be the best model for it.

```{r}
#2c. What is the 95% confidence interval?
cor.test(perimeter_mean ~ texture_mean, data = dat, conf.level = 0.95)
```
```{r}
#2d. What is the 75% confidence level?
cor.test(perimeter_mean ~ texture_mean, data = dat, conf.level = 0.75)
```

#2e. Are you confident that the true population correlation could be zero? Why or why not?

Not very confident at all, even with a confidence level of 99.99%, the interval was still notably above zero. 
In addition, both p-values were pretty much 0, rejecting the NULL hypothesis and accepting the alternate.

## Question 3

3.  Fit an empty model for perimeter_mean,

a.  What are the parameter estimates? Interpret them.

b.  What is the PRE? Interpret it.

c.  Provide a 95% confidence interval around your parameter estimate. How did you obtain it? Interpret it.

```{r}
#3. Fit an empty model for perimeter_mean.
empty_model <- lm(perimeter_mean ~ NULL, data = dat)
empty_model
```

#3a. What are the parameter estimates? Interpret them.

  Y_i = B_0 + e_i
  
An individual Perimeter Mean (Y_i) is being estimated by adding the average Perimeter Mean (B_0) to Error (e_i).

  Y_i = 91.97 + e_i

#3b. What is the PRE? Interpret it.

Given this is an empty model, the PRE would equal 0, because there is no sum of squares error reduction to take 
into consideration. So, SS_Total = SS_Error, such that PRE = (SS_Total-SS_Error)/SS_Total = 0.

```{r}
#3c. Provide a 95% confidence interval around your parameter estimate.  How did you obtain it? Interpret it.
confint(empty_model, level = 0.95)
```

The confint function worked nicely.  The lower bound of b_0 equaled 89.968, and the upper bound of b_0 equaled 93.970

## Question 4

4.  Fit a linear model with perimeter_mean as the outcome and diagnosis as the explanatory variable.

a.  What are the parameter estimates? Interpret them.
b.  What are the 95% confidence intervals around your slope? Describe the method you used to obtain them.
c.  What are the 99% confidence intervals around your slope? Describe the method you used to obtain them.
d.  What is the effect size, expressed as Cohen’s d? i. Interpret the Cohen’s d from the model. ii. What is the 99% confidence interval around Cohen’s d? iii. Interpret the confidence interval for Cohen’s d. What do the units represent?
e.  Do you believe there is a relationship between perimeter_mean and diagnosis? Why or why not?
f.  How does the information you received from the confidence interval relate to the hypothesis that this sample represents (is drawn from) a population with these parameter estimates?

```{r}
dat$diag_binary = recode(dat$diagnosis,"B" = 0,"M" = 1)
#4. Fit a linear model with perimeter_mean as the outcome and diagnosis as the explanatory variable.
cat_model <- lm(perimeter_mean ~ diag_binary, data = dat)
cat_model
```

#4a. What are the parameter estimates? Interpret them.
  
  Y_i = B_0 + B_1(X_1) + e_i
  
An individual (Y_i) perimeter mean of the cell nucleus is being estimated by adding the B_0 coefficient, 
representing the average perimeter mean of the cell nucleus relative to a benign diagnosis, to the B_1 
coefficient, representing the mean difference of perimeter means of the cell nucleus between benign and
malignant diagnosis, multiplied by the binary representation of diagnosis (X_1) as (0 for benign) or 
(1 for malignant), then adding to Error (e_i).

  Y_i = 78.08 + 37.29(X_1) + e_i
  
```{r}
#4b. What are the 95% confidence intervals around your slope? Describe the method you used to obtain them.
confint(cat_model, level = 0.95)
```

The confint function worked nicely.  At a 95% confidence level, the lower bound of B_1 equaled 34.516, and the 
upper bound of B_1 equaled 40.064

```{r}
#4c. What are the 99% confidence intervals around your slope? Describe the method you used to obtain them.
confint(cat_model, level = 0.99)
```

The confint function worked nicely.  At a 99% confidence level, the lower bound of B_1 equaled 33.640, and the 
upper bound of B_1 equaled 40.940

```{r}
#4d. What is the effect size, expressed as Cohen’s d?
PerDiag_cohensd <- cohensD(perimeter_mean ~ diag_binary, data = dat)
cat("The Cohen's d value of", PerDiag_cohensd,"indicates a significantly large effect size.", '\n')
```
  
  #i.  Interpret the Cohen’s d from the model.
  
  There are 2.29 pooled standard deviations in the mean difference of perimeter means relative to benign and 
  malignant diagnosis.
  
```{r}
  #ii. What is the 99% confidence interval around Cohen's d?
CD_int <- cohen.d(
  ~ perimeter_mean,
  ~ diagnosis,
  data = dat,
  conf.level = .99
)
CD_int
```
  
  #iii. Interpret the confidence interval for Cohen’s d. What do the units represent?
  
They are the lower (3.423) and upper (4.147) bound estimates for the number of pooled standard deviations in the 
mean difference of perimeter means relative to benign and malignant diagnosis. 

#4e. Do you believe there is a relationship between perimeter_mean and diagnosis? Why or why not?

Yes, the confidence intervals above and the below p-value near zero safely indicate a rejection of the null hypothesis,
(H0 equals zero) and the acceptance of the alternate hypothesis (H0 does not equal zero). The above Cohen's d value of 2.29
indicates a significantly large effect size. The below PRE value shows that Diagnosis explains 55.15% of the variation 
in Perimeter Means. The below F-statistic is significantly larger than the minimum acceptable 5.

```{r}
PerDiag_cor <- cor(perimeter_mean ~ diag_binary, data = dat)
cat("The correlation between Perimeter Means and Diagnosis (Binary) equals", PerDiag_cor, '\n')
```

Realize that the Pearson's correlation coefficient is not considered valid with a categorical variable, but a single variable binary transformation seems to derive a value that is the square root of the PRE below.

```{r}
supernova(cat_model)
```

#4f - Skip

Was confused by the skip here, but integrated what would be here into #4e.

## Question 5

5.  Fit a linear model with perimeter_mean as the outcome and texture_mean as the explanatory variable.

a.  What are the parameter estimates? Interpret them.

b.  95% confidence intervals around your slope. i. Construct the confidence intervals using bootstrap with 1000 samples. 1. What are the units of the confidence intervals? 2. How would you interpret the confidence interval? ii. Construct the confidence intervals using the model. 1. What are the units of the confidence intervals? 2. How would you interpret the confidence interval? iii. Are you confident that the true population slope parameter is not 0? Why or why not?

c.  75% confidence intervals around your slope. i. Construct the confidence intervals using bootstrap with 1000 samples. ii. Construct the confidence intervals using the model. iii. Are the confidence intervals from these two methods similar? If they are similar, why is this so? If they are not, why not?

d.  What is the effect size, expressed as PRE? Interpret the PRE of the model.

e.  Do you believe there is a relationship between texture_mean and perimeter_mean? Why or why not?

```{r}
#5. Fit a linear model with perimeter_mean as the outcome and texture_mean as the explanatory variable.
linear_model <- lm(perimeter_mean ~ texture_mean, data = dat)
linear_model
```

#5a.  What are the parameter estimates? Interpret them.

  Y_i = B_0 + B_1(X_1) + e_i
  
An individual Perimeter Mean (Y_i) is being estimated by adding the B_0 coefficient value for Perimeter Mean 
of each cell nucleus, to the B_1 coefficient value for Perimeter Mean of each cell nucleus multiplied to every 
unit of (X_1) Texture Mean (standard deviation of gray-scale values), then adding to Error (e_i).

  Y_i = 56.057 + 1.862(X_1) + e_i

#5b.  95% confidence intervals around your slope. 
```{r}
  #i. Construct the confidence intervals using bootstrap with 1000 samples.
lm_boot.95 <- do(1000) *
  lm(
    perimeter_mean ~ texture_mean,
    data = resample(
      dat,
      nrow(dat)
    )
  )
lm_boot.95.ds <- favstats(lm_boot.95$texture_mean)
lm_boot.95.ds
```  
```{r}
  #ii. Construct the confidence intervals using the model.
lm_boot.95.ci <- confint(lm_boot.95, level = 0.95)
lm_boot.95.ci
```  
    
      #1. What are the units of the confidence intervals?
      
The b_0 intercept confidence interval from 48.251 to 64.631 represents units of perimeter mean of the cell 
nucleus.
The b_1 texture_mean confidence interval from 1.409 to 2.304 represents units of standard deviation of 
grey-scale values of each cell nucleus.
The sigma confidence interval from 21.272 to 24.452 represents units of perimeter mean of the cell nucleus.
The r.squared confidence interval from 0.067 to 0.157 represents units of the sum of squared deviations 
of perimeter mean estimates of the cell nucleus.
The F confidence interval from 40.464 to 105.924 represents units of the average of squared deviations 
of perimeter mean estimates of the cell nucleus.

      #2. How you interpret the confidence interval?
      
The confidence interval for b_1 (slope) of 1.409 to 2.304 safely indicate a rejection of the null hypothesis,
(H0 equals zero) and the acceptance of the alternate hypothesis (H0 does not equal zero).

  #iii. Are you confident that the true population slope parameter is not 0? Why or why not?
  
Yes, the confidence intervals above and the below p-value near zero safely indicate a rejection of the null hypothesis,
(H0 equals zero) and the acceptance of the alternate hypothesis (H0 does not equal zero). 

```{r}
PerText_cor <- cor(perimeter_mean ~ texture_mean, data = dat)
cat("The correlation between Perimeter Means and Texture Mean equals", PerText_cor, '\n')
```

Realize that the Pearson's correlation coefficient is not considered valid with a categorical variable, but a single variable  
binary transformation seems to derive a value that is the square root of the PRE below.

```{r}
supernova(linear_model)
```

#5c.  75% confidence intervals around your slope.
```{r}
  #i. Construct the confidence intervals using bootstrap with 1000 samples.
lm_boot.75 <- do(1000) *
  lm(
    perimeter_mean ~ texture_mean,
    data = resample(
      dat,
      nrow(dat)
    )
  )
lm_boot.75.ds <- favstats(lm_boot.75$texture_mean)
lm_boot.75.ds
```  
```{r}
  #ii. Construct the confidence intervals using the model.
lm_boot.75.ci <- confint(lm_boot.75, level = 0.75)
lm_boot.75.ci
```  

  #iii. Are the confidence intervals from these two methods similar? If they are similar, why is this so? If they are not, why not?
  
No, the 75% confidence interval ranges are notably more narrow than the 95% confidence interval ranges.  With the confidence interval 
being 20% less, the potential range of values for b_0 intercept and b_1 (slope) for texture_mean would be reduced. Consequently, this 
would have a similar effect on sample statistics like sigma, r squared, and F.

#5d. What is the effect size, expressed as PRE? Interpret the PRE of the model.

The PRE value showed that the texture mean explains 10.86% of the variation in perimeter mean.

#5e. Do you believe there is a relationship between texture_mean and perimeter_mean? Why or why not?

Yes, the p-value was near zero, and the F-statistic is significantly larger than the minimum acceptable 5.  Although, there was a 
weaker correlation value of 0.33, texture mean did explain some of the variation in perimeter mean.

## Question 6

#6.  Comparing the models in Q4 and Q5, which do you believe predicts perimeter_mean better? Why or why not? Justify your reasoning.

The categorical model utilizing benign and malignant diagnosis to predict the perimeter mean of the cell nucleus seems to be superior 
to the linear model utilizing texture mean of standard deviation of grey-scale values of the cell nucleus to predict the perimeter 
mean of the cell nucleus.  Both models easily passed a 95% confidence interval and p-value assessment, noting that both models were 
significant.  But the diagnosis model explained approximately 45% more of the variation in perimeter means of the cell nucleus, and possessed 
a F-statistic that was ten times greater than that of the texture mean linear model.  Do think that both could be tried in a combined
model to see if the diagnosis model could be improved.
